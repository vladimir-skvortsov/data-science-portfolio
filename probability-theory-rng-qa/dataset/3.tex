\subsection{Сходимость случайных величин по распределению. Лемма о достаточном условии сходимости ожиданий функций из заданного семейства от последовательности случайных величин (лемма 2 из лекции 2). Эквивалентное описание сходимости по распределению.}

\subsubsection{Сходимость случайных величин по распределению}
\begin{definition*} Последовательность случайных величин $X_n$ сходится к случайной величине $X$ \textbf{по распределению}, если $\lim_{n \to \infty} F_{X_n}(x) = F_X(x)$ в каждой точке $x$, в которой непрерывна функция $F_X$. \end{definition*}
В математических обозначениях:
\[ X_n \xrightarrow[]{d} X \;\Leftrightarrow\; F_{X_n}(x) \to F_X(x) \ \ \forall x \text{ т.ч. } \; F_X \text{ непр. в т. } x \]

Точек разрыва у (монотонной!) функции распределения не более чем счетное число (как и попарно не пересекающихся интервалов на прямой).

\subsubsection{Лемма о достаточном условии сходимости ожиданий функций из заданного семейства от последовательности случайных величин (лемма 2 из лекции 2)}

\begin{lemma*}
    Пусть $\{X_n\}_{n=0}^{\infty}$ --- последовательность случайных величин; $\mathcal{F} := \{f\}$ и $\mathcal{G} := \{g\}$ --- системы функций на $\RR$. Пусть также
    \begin{enumerate}
        \item[$1)$] $\forall f \in \mathcal{F} \ \ \EE\,f(X_n) \to \EE\,f(X_0)$;
        \item[$2)$] $\forall g \in \mathcal{G} \ \forall \varepsilon > 0 \ \exists f_{\varepsilon} \in \mathcal{F} : \EE\,|g(X_n) - f_{\varepsilon}(X_n)| \le \varepsilon \ \ \forall n \in \NN \cup \{0\}$
\end{enumerate}

Тогда матожидание $\EE\,g(X_n)$ любой функции из $\mathcal{G}$ от $X_n$ сходится к матожиданию $\EE\,g(X_0)$ этой функции от $X_0$ при $n \to \infty \ \ \left( \forall g \in \mathcal{G} : \EE\,g(X_n) \to \EE\,g(X_0) \right)$.
\end{lemma*}

\begin{proof} В силу условий
    \begin{multline*} 
        |\EE\,g(X_n) - \EE\,g(X_0)| \le |\EE [g(X_n) - f_{\varepsilon/3}(X_n)] + \EE [f_{\varepsilon/3}(X_0) - g(X_0)] + (\EE\,f_{\varepsilon/3}(X_n) - \EE\,f_{\varepsilon/3}(X_0))| \le \\[3 pt]
         \le \underset{\le \varepsilon/3}{\EE\,|g(X_n) - f_{\varepsilon/3}(X_n)|} + \underset{\le \varepsilon/3}{\EE\,|f_{\varepsilon/3}(X_0) - g(X_0)|} + \underset{\le \varepsilon/3}{|\EE\,f_{\varepsilon/3}(X_n) - \EE\,f_{\varepsilon/3}(X_0)|} \le \varepsilon,
     \end{multline*}
     что и требовалось.
\end{proof}

\subsubsection{Эквивалентное описание сходимости по распределению}
\begin{theorem*} Последовательность случайных величин $X_n$ сходится по распределению к $X$ тогда и только тогда, когда 
    \[ \forall g : \RR \to \RR \text{ --- непр. и огр.}: \ \lim_{n \to \infty} \EE\,g(X_n) = \EE\,g(X) \ \ \ 
    \left( F_{X_n} \xrightarrow[]{d} F_X \;\Leftrightarrow\; \EE\,g(X_n) \to \EE\,g(X) \right) \] \end{theorem*}

\begin{proof}
    \begin{itemize}
        \item[$\Leftarrow$] Пусть $t$ --- точка непрерывности $F_X$. Заметим, что 
        $F_X(t) = P(X \le t) = \EE I_{(-\infty; t]}(X)$.
        
        Для всякого $\delta > 0$ определим непрерывные и ограниченные функции
        \[ g_{\delta}(x) = 
        \left\{\begin{array}{ll} 
        1, & x < t - \delta, \\ 
        \delta^{-1}(t - x), & t - \delta \le x \le t, \\ 
        0, & x > t. 
        \end{array}\right. \ \ \  h_{\delta}(x) = 
        \left\{\begin{array}{ll} 
        1, & x < t, \\ 
        \delta^{-1}(t + \delta - x), & t \le x \le t + \delta, \\ 
        0, & x > t + \delta. 
        \end{array}\right. \]
    \end{itemize}
    При этом 
    \[ I_{(-\infty; t - \delta]}(X) \le g_{\delta}(X) \le  I_{(-\infty; t]}(X) \le h_{\delta}(X) \le I_{(-\infty; t + \delta]}(X), \]
    следовательно, 
    \[ \EE\,g_{\delta}(X_n) \le F_{X_n}(t) \le \EE\,h_{\delta}(X_n). \]
    
    Устремляя $n \to \infty$, получаем
    \[ \EE\,g_{\delta}(X) \le \varliminf_{n \to \infty} F_{X_n}(t) \le \varlimsup_{n \to \infty} F_{X_n}(t) \le \EE\,h_{\delta}(X). \]
    \[ F_X(t - \delta) = \EE I_{(-\infty; t - \delta]}(X), \; I_{(-\infty; t - \delta]}(X) \le g_{\delta}(X) \;\Rightarrow\; F_X(t - \delta) \le \EE\,g_{\delta}(X), \]
    аналогично $\EE h_{\delta}(X) \le F_X(t + \delta)$. \\
    
    При $\delta \to 0$ приходим к равенству $\lim_{n \to \infty} F_{X_n}(t) = F_X(t)$. \\
    
    \item[$\Rightarrow$] Известно, что $F_{X_n} \to F_X$ в каждой точке непрерывности $t$, т.е. 
    $\EE I_{(-\infty; t]}(X_n) \to \EE I_{(-\infty; t]}(X)$. \\
    
    Заметим, что $I_{(-\infty; b]}(x) - I_{(-\infty; a]}(x) = I_{(a; b]}(x)$ и обозначим $f_t(x) = I_{(-\infty; t]}(x)$. \\
    
    В силу линейности предела $\EE (f_b(X_n) - f_a(X_n)) \to \EE [f_b(X) - f_a(X)]$.
    
    Обозначим $f(x) = \sum\limits_{j=1}^N c_j I_{(a_j, b_j]}(x)$, где $a_j,\, b_j$ --- точки непрерывности $F_X$. 
    
    Т.к. $f(x) = \sum\limits_{j=1}^N c_j (f_b(x) - f_a(x))$, по линейности предела имеем $\EE\,f(X_n) \to \EE\,f(X)$. \\
    
    Обозначим $\mathcal{F}$ систему функций $f$. Для применения леммы 2.2 достаточно показать, что $\EE\,g(X_n) \to \EE\,f(X_n) \ \forall n \in \NN \cup \{0\}$, т.е.
    \[ \forall \text{ непр. огр. } g \; \forall \varepsilon > 0 \  \exists f \in \mathcal{F} : 
    \EE |g(X_n) - f_{\varepsilon}(X_n)| \le \varepsilon \ \ \forall n \in \NN \cup \{0\} \ (X_0 = X). \]
    
    Пусть $g$ --- произвольная непр. огр. функция на $\RR$ и пусть $\varepsilon > 0$ фиксирован. 
    \[ \left\{\begin{array}{rcl} \lim_{x \to -\infty} F_X(x) &=& 0, \\ \lim_{x \to +\infty} F_X(x) &=& 1 \end{array}\right. \Rightarrow\; \exists A : \left\{\begin{array}{rcl} F_X(-A) &<& \varepsilon, \\ 1 - F_X(A) &<& \varepsilon \end{array}\right. \]
    
    Так как у монотонной функции счетное число точек разрыва, без ограничения общности будем считать, что $A$ --- точка непрерывности $F_X$. Тогда (в силу $F_{X_n} \to F_X$)
    \[ \exists n_0 : \forall n > n_0 \ F_{X_n}(-A) < 2\varepsilon, \; 1 - F_{X_n}(A) < 2\varepsilon \]
    Увеличив $A$, можно считать, что последнее верно для всех $n$ (перешли от $n_0(A)$ к $A(n)$). Таким образом
    \[ \EE \left| I_{\{-A \le X_n \le A\}} g(X_n) - g(X_n) \right| = \EE | \overline{I_{\{-A \le X_n \le A\}}} g(X_n)| \le \sup\,|g| \cdot \underset{\overset{\parallel}{=F_{X_n}(-A) + (1 - F_{X_n}(A))}}{P(|X_n| > A)} \le \sup\,|g| \cdot 4\varepsilon \]
    Та же оценка верна и для предельной случайной величины $X$.
    
    Непрерывная на отрезке $[-A; A]$ функция $g$ равномерно непрерывна на этом отрезке ($\forall \varepsilon > 0 \; \exists \delta : |g(x) - g(x + \delta)| < \varepsilon$), следовательно, ее можно приблизить кусочно-постоянной (ступенчатой) функцией $f_{\varepsilon}$: 
    \[ |g(x) - f_{\varepsilon}(x)| \le \varepsilon \ \forall x \in [-A; A]. \] 
    Также, не ограничивая общности, можно считать, что точки разрыва $f_{\varepsilon}$ --- точки непрерывности $F_X$, т.е. $f_{\varepsilon} \in \mathcal{F}$ (т.к. подходящих точек на отрезке $[x_i; x_i + \delta]$ --- континуум, а точек разрыва счетно).
    
    Пусть $f_{\varepsilon}(x) = 0$ при $x \not\in [-A; A]$. Тогда
    \[ \EE \left| I_{\{-A \le X_n \le A\}} g(X_n) - f_{\varepsilon}(X_n) \right| = \EE \left[ \left| g(X_n) - f_{\varepsilon}(X_n) \right| I_{\{-A \le X_n \le A\}} \right] \le \varepsilon \]
    
    Та же оценка верна и для предельной случайной величины $X$. Таким образом
    \[ \EE \left| g(X_n) - f_{\varepsilon}(X_n) \right| \le \sup\,|g| \cdot 4\varepsilon + \varepsilon. \]
    
    Теорема доказана.
\end{proof}
